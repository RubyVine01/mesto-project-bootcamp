(()=>{"use strict";var e={d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{B:()=>j});var t={baseUrl:"https://mesto.nomoreparties.co/v1/wbf-cohort-12",headers:{authorization:"fa0a7591-098c-48f3-849e-fd0e1a15dbe9","Content-Type":"application/json"}};function o(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function n(e,n,c,r){var a=document.getElementById(c.templateId).content.querySelector(c.cardSelector).cloneNode(!0),i=a.querySelector(c.likeSelector),l=a.querySelector(c.likeCountSelector),u=r.likes.length,d=function(e){e>0?(l.textContent=e,r.likes.forEach((function(e){e._id===c.profileId?i.classList.add(c.likeActiveClass):i.classList.remove(c.likeActiveClass)}))):l.textContent=""};d(u);var s=a.querySelector(c.deleteSelector);r.owner._id!==c.profileId?s.remove():s.addEventListener("click",(function(){var e;(e=r._id,fetch("".concat(t.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:t.headers}).then(o)).then((function(){a.remove()})).catch((function(e){console.log(e)}))}));var p=a.querySelector(c.cardPhotoSelector);return a.querySelector(c.photoDiscriptionSelector).textContent=e,p.src=n,p.alt=e,i.addEventListener("click",(function(e){var n;i.classList.contains("photo-item__like-active")?(n=r._id,fetch("".concat(t.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:t.headers}).then(o)).then((function(t){var o=t.likes.length;d(o),e.target.classList.remove(c.likeActiveClass)})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:t.headers}).then(o)}(r._id).then((function(t){var o=t.likes.length;d(o),e.target.classList.add(c.likeActiveClass)})).catch((function(e){console.log(e)}))})),j(p,n,e),a}function c(e){e.classList.add("popup_opened"),document.addEventListener("keydown",a)}function r(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",a)}function a(e){"Escape"===e.key&&r(document.querySelector(".popup_opened"))}function i(e){e.disabled=!0}function l(e,t){var o=e.querySelector(t.buttonSelector);i(o),e.querySelectorAll(t.inputSelector).forEach((function(n){n.addEventListener("input",(function(){(function(e,t){e.validity.valid?function(e,t){var o="error-"+e.id;document.getElementById(o).textContent="",e.classList.remove(t.invalidTextClass)}(e,t):function(e,t,o){var n="error-"+e.id;document.getElementById(n).textContent=t,e.classList.add(o.invalidTextClass)}(e,e.validationMessage,t)})(n,t),function(e,t){e.checkValidity()?t.disabled=!1:i(t)}(e,o)}))}))}var u={templateId:"photo-card",cardSelector:".photo-item",likeSelector:".photo-item__like",deleteSelector:".photo-item__delete",cardPhotoSelector:".photo-item__photo",photoDiscriptionSelector:".photo-item__discription",popupPhotoId:"popup-view-photo",likeActiveClass:"photo-item__like-active",profileId:"8cd03160afd9d1eccff608ed",likeCountSelector:".photo-item__like-count"};function d(e,t){var o=t.textContent.replace(/[\s.,%]/g,""),n="".concat(o," ...");t.textContent=e?n:o.replace(/[\s.,%]/g,"")}var s,p=document.querySelector(".profile__edit-avatar-button"),f=document.querySelector(".profile__avatar"),h=document.querySelector(".profile__edit-button"),m=document.querySelector(".profile__author-name"),v=document.querySelector(".profile__about-author"),_=document.getElementById("popup-edit-avatar"),y=document.getElementById("input-avatar-link"),S=_.querySelector(".popup__form"),E=document.getElementById("popup-edit-profile"),b=document.getElementById("input-name"),k=document.getElementById("input-about-author"),g=E.querySelector(".popup__form"),q=document.querySelector(".profile__add-button"),C=document.getElementById("popup-add-photo"),L=C.querySelector(".popup__form"),x=document.getElementById("input-photo-name"),I=document.getElementById("input-photo-link"),B=document.querySelector(".save_card"),A=document.querySelector(".photo-place__list"),T=document.getElementById("popup-view-photo"),P=T.querySelector(".popup__photo-image"),U=T.querySelector(".popup__photo-description"),w=document.querySelectorAll(".popup"),D=document.querySelectorAll(".popup__button-close");function O(e,t){var o=t.innerText;e.setAttribute("value",o)}function j(e,t,o){e.addEventListener("click",(function(){P.src=t,P.alt=o,U.textContent=o,c(T)}))}function N(e){A.append(e)}fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then(o).then((function(e){m.textContent=e.name,v.textContent=e.about,f.src=e.avatar})).catch((function(e){console.log(e)})),fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then(o).then((function(e){e.forEach((function(e){N(n(e.name,e.link,u,e))}))})).catch((function(e){console.log(e)})),D.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return r(t)}))})),w.forEach((function(e){!function(e){e.addEventListener("mousedown",(function(t){t.target===e&&r(e)}))}(e)})),h.addEventListener("click",(function(){c(E),O(b,m),O(k,v)})),q.addEventListener("click",(function(){c(C),i(B)})),g.addEventListener("submit",(function(e){e.preventDefault();var n,c,a=b.value,i=k.value;d(!0,e.submitter),(n=a,c=i,fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:n,about:c})}).then(o)).then((function(e){m.textContent=e.name,v.textContent=e.about,r(E)})).then((function(){d(!1,e.submitter)})).catch((function(e){console.log(e)}))})),L.addEventListener("submit",(function(e){var c,a;e.preventDefault(),(c=x.value,a=I.value,fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:c,link:a})}).then(o)).then((function(e){N(n(e.name,e.link,u,e)),L.reset(),r(C)})).catch((function(e){console.log(e)}))})),s={inputSelector:".popup__input-text",buttonSelector:".popup__button-save",formSelector:".popup__form",invalidTextClass:"popup__input-text_invalid"},document.querySelectorAll(s.formSelector).forEach((function(e){l(e,s)})),p.addEventListener("click",(function(){return c(_)})),S.addEventListener("submit",(function(e){var n;e.preventDefault(),(n=y.value,fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:n})}).then(o)).then((function(e){f.src=e.avatar,S.reset(),r(_)})).catch((function(e){console.log(e)}))}))})();